<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Tickets</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background-color: #f4f6f8;
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
        }

        .card-main {
            background-color: #ffffff;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
        }

        .badge-status {
            font-size: 0.75rem;
            padding: 0.35em 0.6em;
            border-radius: 999px;
        }

        .ticket-header {
            font-weight: 600;
            font-size: 1.2rem;
        }

        .table thead th {
            vertical-align: middle;
        }

        @media (max-width: 575.98px) {
            .d-flex-gap-sm {
                flex-direction: column !important;
                gap: 0.5rem !important;
            }
        }
    </style>
</head>
<body>
<div class="container py-4 py-md-5">
    <div class="row justify-content-center">
        <div class="col-lg-10 col-md-11">

            <div class="card-main p-4 p-md-5 shadow-sm">

                <!-- Header -->
                <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap d-flex-gap-sm">
                    <div>
                        <h1 class="ticket-header mb-1">My Tickets</h1>
                        <div class="text-muted" style="font-size: 0.85rem;">
                            Logged in as <span th:text="${fullName}">User Name</span>
                        </div>
                    </div>

                    <div class="d-flex gap-2 flex-wrap">
                        <a href="/dashboard" class="btn btn-outline-secondary btn-sm">
                            Back to dashboard
                        </a>
                        <a href="/tickets/new" class="btn btn-primary btn-sm">
                            Raise new ticket
                        </a>
                    </div>
                </div>

                <!-- Notification / Alerts: show only if there are resolved/closed tickets -->
                <div class="alert alert-success py-2 mb-3"
                     style="font-size: 0.85rem;"
                     th:if="${resolvedTickets != null and !resolvedTickets.isEmpty()}">
                    <strong>Ticket update:</strong>
                    One or more of your tickets have been resolved. Please review the status below.
                </div>

                <!-- Empty State -->
                <p class="text-muted mb-3"
                   style="font-size: 0.9rem;"
                   th:if="${tickets == null or #lists.isEmpty(tickets)}">
                    You have not raised any tickets yet.
                </p>

                <!-- Ticket Table -->
                <div class="table-responsive"
                     th:if="${tickets != null and !#lists.isEmpty(tickets)}">
                    <table class="table table-hover table-sm align-middle mb-0">
                        <thead class="table-light">
                        <tr>
                            <th>ID</th>
                            <th>Title</th>
                            <th>Priority</th>
                            <th>Status</th>
                            <th>Created at</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="ticket : ${tickets}">
                            <td th:text="${ticket.id}">1</td>
                            <td class="text-truncate" style="max-width: 260px;"
                                th:text="${ticket.title}">
                                Sample Ticket
                            </td>
                            <td th:text="${ticket.priority}">MEDIUM</td>

                            <!-- Status badge with simple, safe conditions -->
                            <td>
                                <span class="badge-status bg-warning text-dark badge"
                                      th:if="${ticket.status.name() == 'OPEN'}"
                                      th:text="${ticket.status}">
                                    OPEN
                                </span>
                                <span class="badge-status bg-info text-dark badge"
                                      th:if="${ticket.status.name() == 'IN_PROGRESS'}"
                                      th:text="${ticket.status}">
                                    IN_PROGRESS
                                </span>
                                <span class="badge-status bg-success text-white badge"
                                      th:if="${ticket.status.name() == 'RESOLVED' or ticket.status.name() == 'CLOSED'}"
                                      th:text="${ticket.status}">
                                    RESOLVED
                                </span>
                                <span class="badge-status bg-secondary text-white badge"
                                      th:if="${ticket.status.name() != 'OPEN'
                                              and ticket.status.name() != 'IN_PROGRESS'
                                              and ticket.status.name() != 'RESOLVED'
                                              and ticket.status.name() != 'CLOSED'}"
                                      th:text="${ticket.status}">
                                    OTHER
                                </span>
                            </td>

                            <td th:text="${#temporals.format(ticket.createdAt, 'dd-MM-yyyy HH:mm')}">
                                08-12-2025 11:30
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

            </div><!-- card-main -->

        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
